import{l as o,a as l}from"./DzHiA6Ss.js";import{c as m,h as g}from"./CQA7Wwdt.js";const U=()=>{const u=m(),p=()=>u?!0:(console.warn("‚ö†Ô∏è Cliente Supabase n√£o dispon√≠vel - aguardando inicializa√ß√£o"),!1),i=g("auth.user",()=>null),s=g("auth.loading",()=>!1);return o.debug("üîÑ useAuth chamado - user:",i.value?"Logado":"N√£o logado","loading:",s.value),{user:i,loading:s,login:async(r,e)=>{s.value=!0;try{if(!p())return{error:{message:"Sistema n√£o est√° pronto. Tente novamente em alguns segundos."}};console.log("üîê useAuth.login: Tentando autenticar..."),console.log("üìß Email:",r),console.log("üåê Supabase URL:",u.supabaseUrl);const a=u.auth.signInWithPassword({email:r,password:e}),t=new Promise((d,h)=>setTimeout(()=>h(new Error("Timeout na conex√£o com servidor")),15e3)),{data:n,error:c}=await Promise.race([a,t]);if(console.log("üì• Resposta do Supabase:",{temUsuario:!!n?.user,temSessao:!!n?.session,temErro:!!c}),c){const d=l(c,"useAuth.login");return o.error("‚ùå Erro no login:",d?.userMessage),console.error("‚ùå Erro completo:",c),{error:c}}return n.user&&(i.value=n.user,console.log("‚úÖ Usu√°rio definido no estado:",n.user.email),console.log("üîë Session token existe:",!!n.session?.access_token),console.log("üîë Access token:",n.session?.access_token?.substring(0,20)+"..."),console.log("üîë Refresh token:",n.session?.refresh_token?.substring(0,20)+"..."),o.success("Login realizado com sucesso")),{error:null,data:n}}catch(a){console.error("‚ùå Erro capturado no catch:",a);const t=l(a,"useAuth.login");return o.error("‚ùå Erro inesperado no login:",t?.userMessage),{error:a}}finally{s.value=!1}},register:async(r,e)=>{s.value=!0;try{const{data:a,error:t}=await u.auth.signUp({email:r,password:e,options:{emailRedirectTo:`${window.location.origin}/confirm`,data:{email_confirmed:!1}}});if(t){const n=l(t,"useAuth.register");return o.error("Erro no registro:",n?.userMessage),{error:t,data:null}}return o.success("Registro realizado com sucesso! Verifique seu email."),{error:null,data:a}}catch(a){const t=l(a,"useAuth.register");return o.error("Erro inesperado no registro:",t?.userMessage),{error:a,data:null}}finally{s.value=!1}},logout:async()=>{s.value=!0;try{o.info("üö™ Executando logout no Supabase...");const{error:r}=await u.auth.signOut();if(r){const e=l(r,"useAuth.logout");throw o.error("‚ùå Erro no logout:",e?.userMessage),r}i.value=null,g("auth.user",()=>null),g("auth.loading",()=>!1),o.success("Logout realizado com sucesso")}catch(r){const e=l(r,"useAuth.logout");throw o.error("‚ùå Erro inesperado no logout:",e?.userMessage),r}finally{s.value=!1}},resetPassword:async r=>{s.value=!0;try{const e=`${window.location.origin}/redefinir-senha`;o.info("üîÑ Solicitando recupera√ß√£o de senha..."),o.debug("üìß Email:",r),o.debug("üîó Redirect URL:",e);const{error:a}=await u.auth.resetPasswordForEmail(r,{redirectTo:e});if(a){const t=l(a,"useAuth.resetPassword");return o.error("‚ùå Erro ao solicitar recupera√ß√£o:",t?.userMessage),{error:a}}return o.success("Email de recupera√ß√£o enviado com sucesso"),{error:null}}catch(e){return console.error("‚ùå Erro inesperado na recupera√ß√£o:",e.message||e),{error:e}}finally{s.value=!1}},updatePassword:async r=>{s.value=!0;try{const{error:e}=await u.auth.updateUser({password:r});return e?(console.error("‚ùå Erro ao atualizar senha:",e.message),{error:e}):(console.log("‚úÖ Senha atualizada com sucesso!"),{error:null})}catch(e){return console.error("‚ùå Erro inesperado ao atualizar senha:",e.message||e),{error:e}}finally{s.value=!1}},getUser:async()=>{s.value=!0;try{const{data:{user:r}}=await u.auth.getUser();i.value=r}catch(r){console.error("Erro ao obter usu√°rio:",r),i.value=null}finally{s.value=!1}}}};export{U as u};
