import{J,E as W,$ as r,a3 as s,X as u,P as n,a4 as k,a7 as m,aa as X,W as f,ac as N,V as p,a5 as w,b as i,c as _,U as a}from"./BD3EHYnG.js";import{_ as q}from"./vMbIc8Zx.js";import{_ as R}from"./DRujum_f.js";import{u as G}from"./BDzxMlPQ.js";import{c as K,e as Q}from"./CQA7Wwdt.js";import{s as Y}from"./XJu-Dphy.js";import{b as U,r as M,a as D}from"./CMD1spTT.js";import{r as P,a as ee}from"./-0hij3yz.js";import{r as se}from"./DUHIDQUa.js";import"./DzHiA6Ss.js";const ae={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-secondary-50 p-4"},oe={class:"w-full max-w-md"},te={class:"bg-white rounded-2xl shadow-card p-8"},re={class:"text-center mb-8"},ne={class:"inline-flex items-center justify-center w-16 h-16 bg-primary-100 rounded-full mb-4"},le={key:0,class:"mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg"},ie={class:"flex items-start"},de={class:"text-sm text-green-700 mt-1"},ue={key:1,class:"text-center py-8"},ce={key:2,class:"mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg"},ve={class:"flex items-start"},me={class:"text-sm text-red-800 font-medium"},fe={key:0,class:"text-sm text-red-700 mt-2"},pe={key:0,class:"text-sm text-red-600 -mt-4"},he={class:"space-y-2 -mt-2"},xe={class:"space-y-1"},ge={key:1,class:"h-4 w-4 mr-2 rounded-full border-2 border-secondary-300"},we={key:1,class:"h-4 w-4 mr-2 rounded-full border-2 border-secondary-300"},ye={key:1,class:"h-4 w-4 mr-2 rounded-full border-2 border-secondary-300"},be={key:1,class:"text-sm text-red-600 -mt-4"},ke={key:4},_e={key:5},Pe={key:0,class:"mt-6 text-center"},Ue=J({__name:"redefinir-senha",setup(Ve){const d=i(""),h=i(""),v=i(""),x=i(""),l=i(""),g=i(!1),y=i(!1),V=i(!1),E=i(!1),A=i(3),c=i(!1),b=i(!0),{updatePassword:j}=G(),C=K();Q();const T=_(()=>d.value.length>=8),S=_(()=>/[A-Z]/.test(d.value)),z=_(()=>/[0-9]/.test(d.value)),O=_(()=>T.value&&S.value&&z.value),F=_(()=>d.value&&h.value&&O.value&&d.value===h.value),B=()=>(v.value="",d.value.trim()?d.value.length<8?(v.value="A senha deve ter pelo menos 8 caracteres",!1):S.value?z.value?!0:(v.value="A senha deve conter pelo menos um n√∫mero",!1):(v.value="A senha deve conter pelo menos uma letra mai√∫scula",!1):(v.value="Senha √© obrigat√≥ria",!1)),I=()=>(x.value="",h.value.trim()?d.value!==h.value?(x.value="As senhas n√£o coincidem",!1):!0:(x.value="Confirma√ß√£o de senha √© obrigat√≥ria",!1)),Z=async()=>{try{l.value="",g.value=!1;const t=B(),e=I();if(!t||!e)return;const{error:o}=await j(d.value);if(o)switch(o.message){case"New password should be different from the old password":l.value="A nova senha deve ser diferente da senha atual";break;case"Password should be at least 6 characters":l.value="A senha deve ter pelo menos 6 caracteres";break;default:l.value=`Erro ao redefinir senha: ${o.message}`,console.error("Erro detalhado:",o)}else{g.value=!0,console.log("‚úÖ Senha redefinida com sucesso - fazendo logout..."),await C.auth.signOut();const $=Y(()=>{A.value--,A.value===0&&(clearInterval($),window.location.href="/login")},1e3)}}catch(t){console.error("üî¥ Erro cr√≠tico ao redefinir senha:",t);const e=t&&typeof t=="object"&&"message"in t?String(t.message):"Erro inesperado. Tente novamente em alguns instantes";l.value=e}};W(async()=>{console.log("üìç P√°gina de redefini√ß√£o de senha carregada"),console.log("üîó URL completa:",window.location.href);const t=window.location.hash;console.log("üîç Hash completo na URL:",t||"[VAZIO]"),console.log("‚è≥ Aguardando processamento do token..."),await new Promise(e=>setTimeout(e,1500));try{const{data:{session:e},error:o}=await C.auth.getSession();if(console.log("üîç Resultado da verifica√ß√£o de sess√£o:",{hasSession:!!e,sessionError:o?.message,sessionType:e?.user?"user encontrado":"sem user",hashPresente:!!t&&t.length>0}),o)console.error("‚ùå Erro ao obter sess√£o:",o),l.value="Erro ao validar token de recupera√ß√£o. Tente solicitar um novo link.",c.value=!1;else if(e&&e.user)console.log("‚úÖ Token v√°lido - sess√£o detectada para usu√°rio:",e.user.email),c.value=!0,l.value="";else{console.log("‚ö†Ô∏è Sess√£o n√£o encontrada na primeira tentativa"),console.log("üîÑ Tentando novamente ap√≥s 2 segundos..."),await new Promise(H=>setTimeout(H,2e3));const{data:{session:$}}=await C.auth.getSession();$&&$.user?(console.log("‚úÖ Token v√°lido na segunda tentativa!"),c.value=!0,l.value=""):(console.log("‚ùå Token inv√°lido mesmo ap√≥s retry"),l.value="Link de recupera√ß√£o inv√°lido ou expirado. Por favor, solicite um novo link.",c.value=!1)}}catch(e){console.error("‚ùå Erro ao verificar sess√£o:",e),l.value="Erro ao verificar token de recupera√ß√£o.",c.value=!1}finally{b.value=!1}});const L=async()=>{try{console.log("üö™ Fazendo logout da sess√£o tempor√°ria..."),await C.auth.signOut(),console.log("‚úÖ Logout realizado"),window.location.href="/login"}catch(t){console.error("‚ùå Erro ao fazer logout:",t),window.location.href="/login"}};return(t,e)=>(a(),r("div",ae,[s("div",oe,[s("div",te,[s("div",re,[s("div",ne,[u(n(U),{class:"h-8 w-8 text-primary-600"})]),e[6]||(e[6]=s("h1",{class:"text-2xl font-bold text-secondary-900 mb-2"}," Redefinir Senha ",-1)),e[7]||(e[7]=s("p",{class:"text-sm text-secondary-600"}," Digite sua nova senha para acessar o sistema ",-1))]),g.value?(a(),r("div",le,[s("div",ie,[u(n(P),{class:"h-5 w-5 text-green-500 mt-0.5 mr-3 flex-shrink-0"}),s("div",null,[e[8]||(e[8]=s("p",{class:"text-sm font-medium text-green-800"}," Senha atualizada com sucesso! ",-1)),s("p",de," Voc√™ ser√° redirecionado para o login em "+k(A.value)+" segundos... ",1)])])])):m("",!0),b.value?(a(),r("div",ue,[...e[9]||(e[9]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mb-4"},null,-1),s("p",{class:"text-sm text-secondary-600"}," Verificando token de recupera√ß√£o... ",-1)])])):m("",!0),l.value&&!b.value?(a(),r("div",ce,[s("div",ve,[u(n(ee),{class:"h-5 w-5 text-red-500 mt-0.5 mr-3 flex-shrink-0"}),s("div",null,[s("p",me,k(l.value),1),c.value?m("",!0):(a(),r("p",fe,' Para redefinir sua senha, acesse a p√°gina de login e clique em "Esqueceu sua senha?". '))])])])):m("",!0),!g.value&&!b.value&&c.value?(a(),r("form",{key:3,onSubmit:X(Z,["prevent"]),class:"space-y-6"},[u(q,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),label:"Nova Senha",type:V.value?"text":"password",placeholder:"Digite sua nova senha","prefix-icon":n(U),autocomplete:"new-password",required:"",size:"md",disabled:y.value,onBlur:B,onInput:e[2]||(e[2]=o=>v.value="")},{suffix:f(()=>[s("button",{type:"button",onClick:e[0]||(e[0]=o=>V.value=!V.value),class:"focus:outline-none",tabindex:"-1"},[V.value?(a(),p(n(D),{key:1,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"})):(a(),p(n(M),{key:0,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"}))])]),_:1},8,["modelValue","type","prefix-icon","disabled"]),v.value?(a(),r("p",pe,k(v.value),1)):m("",!0),s("div",he,[e[13]||(e[13]=s("p",{class:"text-xs font-medium text-secondary-700"}," Requisitos da senha: ",-1)),s("div",xe,[s("div",{class:N(["flex items-center text-xs",T.value?"text-green-600":"text-secondary-500"])},[T.value?(a(),p(n(P),{key:0,class:"h-4 w-4 mr-2"})):(a(),r("div",ge)),e[10]||(e[10]=w(" M√≠nimo de 8 caracteres ",-1))],2),s("div",{class:N(["flex items-center text-xs",S.value?"text-green-600":"text-secondary-500"])},[S.value?(a(),p(n(P),{key:0,class:"h-4 w-4 mr-2"})):(a(),r("div",we)),e[11]||(e[11]=w(" Pelo menos uma letra mai√∫scula ",-1))],2),s("div",{class:N(["flex items-center text-xs",z.value?"text-green-600":"text-secondary-500"])},[z.value?(a(),p(n(P),{key:0,class:"h-4 w-4 mr-2"})):(a(),r("div",ye)),e[12]||(e[12]=w(" Pelo menos um n√∫mero ",-1))],2)])]),u(q,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=o=>h.value=o),label:"Confirmar Nova Senha",type:E.value?"text":"password",placeholder:"Digite novamente sua nova senha","prefix-icon":n(U),autocomplete:"new-password",required:"",size:"md",disabled:y.value,onBlur:I,onInput:e[5]||(e[5]=o=>x.value="")},{suffix:f(()=>[s("button",{type:"button",onClick:e[3]||(e[3]=o=>E.value=!E.value),class:"focus:outline-none",tabindex:"-1"},[E.value?(a(),p(n(D),{key:1,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"})):(a(),p(n(M),{key:0,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"}))])]),_:1},8,["modelValue","type","prefix-icon","disabled"]),x.value?(a(),r("p",be,k(x.value),1)):m("",!0),u(R,{type:"submit",variant:"primary",size:"lg",loading:y.value,disabled:y.value||!F.value,"full-width":""},{icon:f(()=>[u(n(P),{class:"h-5 w-5"})]),default:f(()=>[w(" "+k(y.value?"Atualizando...":"Redefinir Senha"),1)]),_:1},8,["loading","disabled"]),s("div",{class:"text-center"},[s("button",{type:"button",onClick:L,class:"text-sm text-primary-600 hover:text-primary-700 font-medium transition-colors"}," ‚Üê Voltar para o login ")])],32)):g.value?(a(),r("div",ke,[u(R,{variant:"primary",size:"lg","full-width":"",onClick:L},{icon:f(()=>[u(n(se),{class:"h-5 w-5"})]),default:f(()=>[e[14]||(e[14]=w(" Ir para o Login ",-1))]),_:1})])):!b.value&&!c.value?(a(),r("div",_e,[u(R,{variant:"secondary",size:"lg","full-width":"",onClick:L},{default:f(()=>[...e[15]||(e[15]=[w(" Voltar para o Login ",-1)])]),_:1})])):m("",!0)]),c.value||g.value?(a(),r("div",Pe,[...e[16]||(e[16]=[s("p",{class:"text-sm text-secondary-600"}," Ap√≥s redefinir, voc√™ poder√° fazer login com sua nova senha. ",-1)])])):m("",!0)])]))}});export{Ue as default};
