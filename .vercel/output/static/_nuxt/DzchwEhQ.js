import{U as r,$ as d,a3 as s,X as b,P as t,ac as E,a4 as p,a7 as f,aa as O,W as k,V as w,a5 as R,z as K,b as m}from"./BD3EHYnG.js";import{_ as V}from"./vMbIc8Zx.js";import{_ as z}from"./DRujum_f.js";import{u as Q}from"./BDzxMlPQ.js";import{a as Y,u as ee}from"./CQA7Wwdt.js";import{r as W}from"./B0DfXmFT.js";import{r as I,a as U,b as T}from"./CMD1spTT.js";import{r as ae}from"./DUHIDQUa.js";import"./DzHiA6Ss.js";function se(q,_){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function oe(q,_){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"})])}const te={class:"w-full max-w-md mx-auto"},re={class:"bg-white rounded-2xl shadow-strong p-8 border border-neutral-100"},ne={class:"text-center mb-8"},le={class:"flex items-center justify-center space-x-3 mb-4"},ie={class:"flex mb-6 bg-neutral-100 rounded-xl p-1"},ue={key:0,class:"space-y-6"},de={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},ce={class:"text-sm text-red-600 font-medium"},me={key:0,class:"text-sm text-red-600 mt-1"},ve={key:1,class:"text-sm text-red-600 mt-1"},pe={key:1,class:"space-y-6"},fe={key:0,class:"bg-success-50 border border-success-200 rounded-lg p-4"},ge={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},xe={class:"text-sm text-red-600 font-medium"},we={key:0,class:"text-sm text-red-600 mt-1"},be={key:1,class:"text-sm text-red-600 mt-1"},he={class:"text-xs text-secondary-600 space-y-1"},ye={class:"list-disc list-inside space-y-0.5 ml-2"},ke={key:2,class:"text-sm text-red-600 mt-1"},Ee={__name:"LoginForm",setup(q){const{login:_,register:C,loading:c}=Q();Y();const h=m("login"),o=m(""),i=m(""),l=m(""),y=m(""),g=m(!1),S=m(!1),P=m(!1),$=m(!1),v=m({email:"",password:""}),n=m({email:"",password:"",confirmPassword:""}),B=u=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u),D=()=>(i.value="",v.value.email.trim()?B(v.value.email)?!0:(i.value="Digite um e-mail vÃ¡lido (exemplo: usuario@email.com)",!1):(i.value="E-mail Ã© obrigatÃ³rio",!1)),N=()=>(l.value="",v.value.password.trim()?!0:(l.value="Senha Ã© obrigatÃ³ria",!1)),L=()=>(l.value="",n.value.password.trim()?n.value.password.length<8?(l.value="A senha deve ter pelo menos 8 caracteres",!1):/[A-Z]/.test(n.value.password)?/[0-9]/.test(n.value.password)?!0:(l.value="A senha deve conter pelo menos um nÃºmero",!1):(l.value="A senha deve conter pelo menos uma letra maiÃºscula",!1):(l.value="Senha Ã© obrigatÃ³ria",!1)),M=()=>(y.value="",n.value.confirmPassword.trim()?n.value.password!==n.value.confirmPassword?(y.value="As senhas nÃ£o coincidem",!1):!0:(y.value="ConfirmaÃ§Ã£o de senha Ã© obrigatÃ³ria",!1)),j=()=>(i.value="",n.value.email.trim()?B(n.value.email)?!0:(i.value="Digite um e-mail vÃ¡lido (exemplo: usuario@email.com)",!1):(i.value="E-mail Ã© obrigatÃ³rio",!1)),Z=()=>{i.value="",o.value=""},H=()=>{l.value="",o.value=""},A=m(!1),J=()=>{if(A.value){console.log("âš ï¸ NavegaÃ§Ã£o jÃ¡ em andamento, ignorando clique");return}A.value=!0,console.log("ğŸ”‘ Navegando para /recuperar-senha usando window.location"),window.location.href="/recuperar-senha",setTimeout(()=>{A.value=!1},1e3)},X=async()=>{try{if(console.log("ğŸ” Iniciando processo de login..."),console.log("ğŸ“± User Agent:",navigator.userAgent),console.log("ğŸŒ Online:",navigator.onLine),o.value="",i.value="",l.value="",!navigator.onLine){o.value="Sem conexÃ£o com a internet. Verifique sua rede.",console.error("âŒ Dispositivo offline");return}const u=D(),e=N();if(console.log("ğŸ“‹ ValidaÃ§Ãµes:",{isEmailValid:u,isPasswordValid:e}),!u||!e){console.log("âŒ ValidaÃ§Ã£o falhou, abortando login");return}console.log("ğŸ”„ Chamando funÃ§Ã£o de login do Supabase..."),window.innerWidth<768&&console.log("ğŸ“± Dispositivo mÃ³vel detectado");const{error:a,data:x}=await _(v.value.email.trim(),v.value.password);if(console.log("ğŸ“¥ Resposta do login:",a?"ERRO":"SUCESSO"),x&&console.log("ğŸ“¦ Dados recebidos:",{hasUser:!!x.user,hasSession:!!x.session,userEmail:x.user?.email}),a){if(console.error("ğŸ”´ Erro de login:",a.message),a.message?.includes("fetch")||a.message?.includes("Failed to fetch")||a.message?.includes("NetworkError")||a.message?.includes("ECONNREFUSED")){o.value="Erro de conexÃ£o. Verifique sua internet e tente novamente.",console.error("ğŸŒ Problema de rede detectado");return}if(a.message?.includes("Invalid API key")||a.message?.includes("JWT")||a.message?.includes("fetch")){o.value="âš ï¸ Erro de configuraÃ§Ã£o do Supabase. Verifique as credenciais no arquivo .env";return}switch(a.message){case"Invalid login credentials":o.value="E-mail ou senha incorretos. Verifique seus dados e tente novamente";break;case"Email not confirmed":o.value="E-mail nÃ£o confirmado. Verifique sua caixa de entrada e confirme seu cadastro";break;case"Too many requests":o.value="Muitas tentativas de login. Aguarde alguns minutos e tente novamente";break;case"User not found":o.value="UsuÃ¡rio nÃ£o encontrado. Verifique o e-mail digitado";break;case"Invalid password":o.value="Senha incorreta. Tente novamente";break;case"signInWithPassword":o.value="Erro de autenticaÃ§Ã£o. Verifique suas credenciais";break;default:o.value=`Erro ao fazer login: ${a.message}`,console.error("Erro detalhado:",a)}}else v.value.email="",v.value.password="",o.value="",i.value="",l.value="",console.log("âœ… Login bem-sucedido!"),console.log("ğŸ’¾ Marcando login como concluÃ­do..."),sessionStorage.setItem("justLoggedIn","true"),sessionStorage.setItem("loginTimestamp",Date.now().toString()),console.log("â³ Aguardando 1.5 segundos para garantir persistÃªncia da sessÃ£o..."),await new Promise(F=>setTimeout(F,1500)),console.log("ğŸ”„ Redirecionando para pÃ¡gina principal..."),window.location.replace("/")}catch(u){console.error("ğŸ”´ Erro crÃ­tico no login:",u);const e=u&&typeof u=="object"&&"message"in u?u.message:"Erro inesperado no servidor. Tente novamente em alguns instantes";o.value=e,window.innerWidth<768&&alert("ERRO: "+e)}},G=async()=>{try{o.value="",i.value="",l.value="",y.value="",g.value=!1;const u=j(),e=L(),a=M();if(!u||!e||!a)return;const{error:x,data:F}=await C(n.value.email.trim(),n.value.password);if(x)switch(x.message){case"User already registered":o.value="Este e-mail jÃ¡ estÃ¡ cadastrado. Tente fazer login.";break;case"Password should be at least 6 characters":o.value="A senha deve ter pelo menos 6 caracteres";break;case"Signup requires a valid password":o.value="Digite uma senha vÃ¡lida";break;default:o.value="Erro ao criar conta. Tente novamente.",console.error("Erro detalhado:",x)}else g.value=!0,o.value="",n.value={email:"",password:"",confirmPassword:""}}catch(u){console.error("Erro no registro:",u),o.value="Erro inesperado no servidor. Tente novamente em alguns instantes"}};return(u,e)=>(r(),d("div",te,[s("div",re,[s("div",ne,[s("div",le,[b(t(se),{class:"h-10 w-10 text-primary-500"}),e[14]||(e[14]=s("h2",{class:"text-3xl font-bold text-secondary-800"}," Acesso ao Sistema ",-1))]),e[15]||(e[15]=s("p",{class:"text-secondary-600"}," Entre ou crie sua conta para acessar o sistema ",-1))]),s("div",ie,[s("button",{onClick:e[0]||(e[0]=a=>h.value="login"),class:E(["flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-all duration-200",h.value==="login"?"bg-white text-primary-600 shadow-soft":"text-secondary-600 hover:text-secondary-800"])}," Entrar ",2),s("button",{onClick:e[1]||(e[1]=a=>h.value="register"),class:E(["flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-all duration-200",h.value==="register"?"bg-white text-primary-600 shadow-soft":"text-secondary-600 hover:text-secondary-800"])}," Criar Conta ",2)]),h.value==="login"?(r(),d("div",ue,[o.value?(r(),d("div",de,[s("p",ce,p(o.value),1)])):f("",!0),s("form",{onSubmit:O(X,["prevent"]),class:"space-y-5"},[b(V,{modelValue:v.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.email=a),label:"E-mail",type:"email",placeholder:"Digite seu e-mail","prefix-icon":t(W),autocomplete:"email",required:"",size:"md",disabled:t(c),onBlur:D,onInput:Z},null,8,["modelValue","prefix-icon","disabled"]),i.value?(r(),d("div",me,p(i.value),1)):f("",!0),b(V,{modelValue:v.value.password,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.password=a),label:"Senha",type:S.value?"text":"password",placeholder:"Digite sua senha","prefix-icon":t(T),autocomplete:"current-password",required:"",size:"md",disabled:t(c),onBlur:N,onInput:H},{suffix:k(()=>[s("button",{type:"button",onClick:e[3]||(e[3]=a=>S.value=!S.value),class:"focus:outline-none",tabindex:"-1"},[S.value?(r(),w(t(U),{key:1,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"})):(r(),w(t(I),{key:0,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"}))])]),_:1},8,["modelValue","type","prefix-icon","disabled"]),l.value?(r(),d("div",ve,p(l.value),1)):f("",!0),b(z,{type:"submit",variant:"primary",size:"lg",icon:t(ae),"full-width":"",loading:t(c),disabled:t(c)},{default:k(()=>[R(p(t(c)?"Entrando...":"Entrar no Sistema"),1)]),_:1},8,["icon","loading","disabled"])],32),s("div",{class:"text-center"},[s("button",{type:"button",onClick:J,class:"text-sm text-primary-600 hover:text-primary-700 font-medium transition-colors duration-200 cursor-pointer hover:underline"}," Esqueceu sua senha? ")])])):h.value==="register"?(r(),d("div",pe,[g.value?(r(),d("div",fe,[...e[16]||(e[16]=[K('<div class="flex items-center"><svg class="w-5 h-5 text-success-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div><p class="text-sm text-success-800 font-semibold"> Conta criada com sucesso! </p><p class="text-sm text-success-700 mt-1"> Enviamos um email de confirmaÃ§Ã£o para vocÃª. Verifique sua caixa de entrada e confirme seu cadastro para fazer login. </p></div></div>',1)])])):f("",!0),o.value&&!g.value?(r(),d("div",ge,[s("p",xe,p(o.value),1)])):f("",!0),s("form",{onSubmit:O(G,["prevent"]),class:"space-y-5"},[b(V,{modelValue:n.value.email,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.email=a),label:"E-mail",type:"email",placeholder:"Digite seu e-mail","prefix-icon":t(W),autocomplete:"email",required:"",size:"md",disabled:t(c)||g.value,onBlur:j,onInput:e[6]||(e[6]=a=>i.value="")},null,8,["modelValue","prefix-icon","disabled"]),i.value?(r(),d("div",we,p(i.value),1)):f("",!0),b(V,{modelValue:n.value.password,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.password=a),label:"Senha",type:P.value?"text":"password",placeholder:"Crie uma senha forte","prefix-icon":t(T),autocomplete:"new-password",required:"",size:"md",disabled:t(c)||g.value,onBlur:L,onInput:e[9]||(e[9]=a=>l.value="")},{suffix:k(()=>[s("button",{type:"button",onClick:e[7]||(e[7]=a=>P.value=!P.value),class:"focus:outline-none",tabindex:"-1"},[P.value?(r(),w(t(U),{key:1,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"})):(r(),w(t(I),{key:0,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"}))])]),_:1},8,["modelValue","type","prefix-icon","disabled"]),l.value?(r(),d("div",be,p(l.value),1)):f("",!0),s("div",he,[e[17]||(e[17]=s("p",{class:"font-medium"},"Requisitos da senha:",-1)),s("ul",ye,[s("li",{class:E(n.value.password.length>=8?"text-success-600":"text-secondary-500")}," MÃ­nimo de 8 caracteres ",2),s("li",{class:E(/[A-Z]/.test(n.value.password)?"text-success-600":"text-secondary-500")}," Uma letra maiÃºscula ",2),s("li",{class:E(/[0-9]/.test(n.value.password)?"text-success-600":"text-secondary-500")}," Um nÃºmero ",2)])]),b(V,{modelValue:n.value.confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.confirmPassword=a),label:"Confirmar Senha",type:$.value?"text":"password",placeholder:"Confirme sua senha","prefix-icon":t(T),autocomplete:"new-password",required:"",size:"md",disabled:t(c)||g.value,onBlur:M,onInput:e[12]||(e[12]=a=>y.value="")},{suffix:k(()=>[s("button",{type:"button",onClick:e[10]||(e[10]=a=>$.value=!$.value),class:"focus:outline-none",tabindex:"-1"},[$.value?(r(),w(t(U),{key:1,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"})):(r(),w(t(I),{key:0,class:"h-5 w-5 text-neutral-400 hover:text-neutral-600 transition-colors cursor-pointer"}))])]),_:1},8,["modelValue","type","prefix-icon","disabled"]),y.value?(r(),d("div",ke,p(y.value),1)):f("",!0),g.value?(r(),w(z,{key:4,onClick:e[13]||(e[13]=a=>h.value="login"),variant:"primary",size:"lg","full-width":""},{default:k(()=>[...e[18]||(e[18]=[R(" Ir para Login ",-1)])]),_:1})):(r(),w(z,{key:3,type:"submit",variant:"success",size:"lg",icon:t(oe),"full-width":"",loading:t(c),disabled:t(c)},{default:k(()=>[R(p(t(c)?"Criando conta...":"Criar Conta"),1)]),_:1},8,["icon","loading","disabled"]))],32)])):f("",!0)]),e[19]||(e[19]=s("div",{class:"mt-6 text-center"},[s("p",{class:"text-sm text-secondary-500"}," Sistema seguro de controle de portaria ")],-1))]))}},Ve={class:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50 flex items-center justify-center py-12 px-4"},_e={class:"relative z-10 w-full max-w-md"},Ue={__name:"login",setup(q){return ee({title:"Login - Sistema de Portaria",meta:[{name:"description",content:"FaÃ§a login ou crie sua conta no Sistema de Portaria"}]}),(_,C)=>{const c=Ee;return r(),d("div",null,[s("div",Ve,[C[0]||(C[0]=s("div",{class:"absolute inset-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute -top-40 -right-40 w-80 h-80 bg-primary-100 rounded-full opacity-20 blur-3xl"}),s("div",{class:"absolute -bottom-40 -left-40 w-96 h-96 bg-secondary-100 rounded-full opacity-20 blur-3xl"})],-1)),s("div",_e,[b(c)])])])}}};export{Ue as default};
