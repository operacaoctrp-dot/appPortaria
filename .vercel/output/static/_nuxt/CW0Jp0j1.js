import{U as y,$ as C,a3 as M,I as w,b as m}from"./BD3EHYnG.js";import{l as u,h as f}from"./DzHiA6Ss.js";import{c as I}from"./CQA7Wwdt.js";function D(l,b){return y(),C("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function P(l,b){return y(),C("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[M("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"})])}const j=()=>{const l=I(),b=()=>l?!0:(console.warn("‚ö†Ô∏è Cliente Supabase n√£o dispon√≠vel - aguardando inicializa√ß√£o"),!1),p=async()=>{try{if(!b())return{success:!1,error:new Error("Cliente Supabase n√£o dispon√≠vel")};u.debug("üß™ Testando conex√£o com Supabase...");const{data:o,error:r}=await l.from("colaboradores").select("count",{count:"exact",head:!0});return u.debug("üß™ Teste de conectividade - Data:",o),u.debug("üß™ Teste de conectividade - Error:",r),{success:!r,error:r}}catch(o){return u.error("üß™ Erro no teste de conectividade:",o),{success:!1,error:o}}},d=m([]),t=m(!1),s=m(null),E=async o=>{try{if(!b()){s.value="Cliente Supabase n√£o dispon√≠vel";return}u.info("üîç Iniciando busca de colaboradores..."),await p(),t.value=!0,s.value=null;let r=l.from("colaboradores").select("*").order("nome",{ascending:!0});o&&(u.debug("üîé Aplicando filtros:",o),o.matricula&&(r=r.eq("matricula",o.matricula)),o.nome&&(r=r.ilike("nome",`%${o.nome}%`)),o.funcao&&(r=r.ilike("funcao",`%${o.funcao}%`)),o.filial&&(r=r.ilike("filial",`%${o.filial}%`))),u.debug("üì° Fazendo requisi√ß√£o para Supabase...");const{data:a,error:e}=await r;if(e){const c=f(e,"useColaboradores.buscarColaboradores");throw s.value=c.userMessage,new Error(c.userMessage)}return d.value=a||[],u.success("Colaboradores carregados",`${d.value.length} registros`),a||[]}catch(r){const a=f(r,"useColaboradores.buscarColaboradores");throw s.value=a.userMessage,r}finally{t.value=!1}},$=async o=>{try{t.value=!0,s.value=null;const{data:r,error:a}=await l.from("colaboradores").select("*").eq("id",o).single();if(a){const e=f(a,"useColaboradores.buscarColaboradorPorId");throw s.value=e.userMessage,new Error(e.userMessage)}return r}catch(r){const a=f(r,"useColaboradores.buscarColaboradorPorId");throw s.value=a.userMessage,r}finally{t.value=!1}},k=async o=>{try{t.value=!0,s.value=null;const{data:r,error:a}=await l.from("colaboradores").select("*").eq("matricula",o).single();if(a)throw new Error(a.message);return r}catch(r){const a=r instanceof Error?r.message:"Erro ao buscar colaborador por matr√≠cula";throw s.value=a,console.error("Erro ao buscar colaborador por matr√≠cula:",r),r}finally{t.value=!1}},g=async(o,r)=>{try{t.value=!0,s.value=null,console.log("üìù Atualizando colaborador:",o,r);const{data:a,error:e}=await l.from("colaboradores").update(r).eq("id",o).select().single();if(e)throw new Error(e.message);const c=d.value.findIndex(n=>n.id===o);return c!==-1&&(d.value[c]=a),console.log("‚úÖ Colaborador atualizado:",a),a}catch(a){const e=a instanceof Error?a.message:"Erro ao atualizar colaborador";throw s.value=e,console.error("Erro ao atualizar colaborador:",a),a}finally{t.value=!1}},h=async o=>{try{t.value=!0,s.value=null,console.log("‚ûï Criando novo colaborador:",o);const{data:r,error:a}=await l.from("colaboradores").insert([o]).select().single();if(a)throw console.error("Erro do Supabase:",a),new Error(`Erro ao criar colaborador: ${a.message}`);return console.log("‚úÖ Colaborador criado:",r),await E(),r}catch(r){const a=r instanceof Error?r.message:"Erro ao criar colaborador";throw s.value=a,console.error("Erro ao criar colaborador:",r),r}finally{t.value=!1}},S=async(o,r)=>{try{t.value=!0,s.value=null;let a=d.value.find(i=>i.nome?.toLowerCase().trim()===o.toLowerCase().trim());a||(a=await h({nome:o.trim(),funcao:r?.trim()||"N√£o informado"}));let e=null;for(let i=1;i<=5;i++){const v=`ent${i}`,z=`sai${i}`;if(!a[v]||!a[z]){e=i;break}}if(!e)throw new Error("Colaborador j√° tem 5 movimenta√ß√µes registradas hoje");const c=new Date,n={[`ent${e}`]:c.toISOString()};return await g(a.id,n),console.log(`‚úÖ Entrada registrada para ${o} no slot ${e}`),{colaborador:a,slot:e}}catch(a){const e=a instanceof Error?a.message:"Erro ao registrar entrada";throw s.value=e,console.error("Erro ao registrar entrada:",a),a}finally{t.value=!1}},x=async o=>{try{t.value=!0,s.value=null;const r=d.value.find(n=>n.id===o);if(!r)throw new Error("Colaborador n√£o encontrado");let a=null;for(let n=5;n>=1;n--){const i=`ent${n}`,v=`sai${n}`;if(r[i]&&!r[v]){a=n;break}}if(!a)throw new Error("Colaborador n√£o tem entrada sem sa√≠da correspondente");const e=new Date,c={[`sai${a}`]:e.toISOString()};return await g(o,c),console.log(`‚úÖ Sa√≠da registrada para ${r.nome} no slot ${a}`),{colaborador:r,slot:a}}catch(r){const a=r instanceof Error?r.message:"Erro ao registrar sa√≠da";throw s.value=a,console.error("Erro ao registrar sa√≠da:",r),r}finally{t.value=!1}};return{colaboradores:w(d),loading:w(t),error:w(s),buscarColaboradores:E,buscarColaboradorPorId:$,buscarColaboradorPorMatricula:k,atualizarColaborador:g,criarColaborador:h,registrarEntrada:S,registrarSaida:x,testarConexao:p}};export{D as a,P as r,j as u};
